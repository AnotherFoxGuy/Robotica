language: cpp

matrix:
  include:
    - os: linux
      dist: bionic
      name: Linux Build
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-8
            - mesa-common-dev
            - libegl1-mesa-dev
            - libasound2-dev
            - libpulse-dev
            - libxcursor-dev
            - libxinerama-dev
            - libxi-dev
            - libxrandr-dev
      cache:
        directories:
          - $HOME/.conan/
      install:
        - wget https://dl.bintray.com/conan/installers/conan-ubuntu-64_1_25_1.deb -nv
        - sudo dpkg -i ./conan-ubuntu-64_1_25_1.deb
        - conan user
      script:
        - cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=gcc-8 -DCMAKE_CXX_COMPILER=g++-8 .
        - make -j
      before_cache:
        - cmake -P cmake/pmm.cmake /Conan /Clean

    - os: windows
      name: Windows Build
      cache:
        directories:
          - $HOME/.conan/
          - C:/.conan
      install:
        - choco install conan -y -s="https://api.bintray.com/nuget/anotherfoxguy/choco-pkg"
        - choco install ninja -y
      script:
        - export CXX="cl.exe"
        - export CXX_FOR_BUILD="cl.exe"
        - export CC="cl.exe"
        - export CC_FOR_BUILD="cl.exe"
        - ./.ci/run.bat