<!doctype html>
<html lang="en">
<head>
    <title>Controller GUI</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="joy.min.js"></script>
    <style>
        .slidecontainer {
            width: 100%;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            background: #4CAF50;
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

<body class="bg-light"></body>

<div class="container p-3 my-3 bg-dark text-white">
    <h1 class="text-center">Controller Robotica Groep 7</h1>
</div>

<div class="container p-3 my-3 border">
    <div id="joystickveld" style="height: 20px;"></div>
    <div id="joyDiv"
         style="width:300px;height:300px;margin-bottom:20px; border: 1px solid #9C9898; overflow: hidden; float: left;"></div>
    <div class="row">

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Gripper</h6>
                <div class="slidecontainer">
                    <input type="range" min="-90" max="90" value="0" class="slider" id="myRange1">
                    <p>Waarde: <span id="demo1"></span> graden</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Rotate gripper</h6>
                <div class="slidecontainer">
                    <input type="range" min="-90" max="90" value="0" class="slider" id="myRange2">
                    <p>Waarde: <span id="demo2"></span> graden</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Lift arm</h6>
                <div class="slidecontainer">
                    <input type="range" min="-90" max="90" value="0" class="slider" id="myRange3">
                    <p>Waarde: <span id="demo3"></span> graden</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Rotate arm</h6>
                <div class="slidecontainer">
                    <input type="range" min="-90" max="90" value="0" class="slider" id="myRange4">
                    <p>Waarde: <span id="demo4"></span> graden</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container p-3 my-3 border">
    <h6 class="text-center">Snelheid instellen robot voortbeweging</h6>
    <div class="slidecontainer">
        <input type="range" min="1" max="100" value="50" class="slider" id="myRange5">
        <p>Waarde: <span id="demo5"></span></p>
    </div>
</div>

<div class="container p-3 my-3 border">
    <div class="btn-group btn-block" id="switchmodes">
        <button type="button" onclick="doSend('manual')" class="btn btn-outline-primary active">Manual</button>
        <button type="button" onclick="doSend('moonrace')" class="btn btn-outline-primary">Moonrace</button>
        <button type="button" onclick="doSend('moondance')" class="btn btn-outline-primary">Moondance</button>
        <button type="button" onclick="doSend('moonwalk')" class="btn btn-outline-primary autonoom">Moonwalk</button>
        <button type="button" onclick="doSend('moonsurvival')" class="btn btn-outline-primary autonoom">Moonsurvival
        </button>
        <button type="button" onclick="doSend('moonmaze')" class="btn btn-outline-primary autonoom">Moonmaze</button>
        <button type="button" onclick="doSend('plant_the_flag')" class="btn btn-outline-primary">Plant the Flag</button>
        <div class="dropup">
            <button type="button" class="btn btn-outline-primary dropdown-toggle autonoom" data-toggle="dropdown">Cart
                Search
            </button>
            <div class="dropdown-menu">
                <a onclick="doSend('harten')" class="dropdown-item" href="#">Harten</a>
                <a onclick="doSend('klaver')" class="dropdown-item" href="#">Klaver</a>
                <a onclick="doSend('ruiten')" class="dropdown-item" href="#">Ruiten</a>
                <a onclick="doSend('schopen')" class="dropdown-item" href="#">Schopen</a>
            </div>
        </div>
    </div>

    <div class="btn-group btn-block" data-toggle="button" aria-label="Basic example">
        <button type="button" onclick="doSend('autonoom')" class="btn btn-outline-warning" id="btnAutonoom">Autonoom
        </button>
    </div>
</div>

<div class="container p-3 my-3 border">
    <button type="button" class="btn btn-outline-primary dropdown-toggle" data-toggle="dropdown">Robot keuze</button>
    <div class="dropdown-menu" id="select_robot">

    </div>
    <button type="button" class="btn btn-success active" onclick="update_robot_list()">Update</button>
</div>

<div class="container p-3 my-3 border">
    <div class="btn-group btn-block" id="startstop">
        <button type="button" onclick="doSend('start')" class="btn btn-outline-success">Start</button>
        <button type="button" onclick="doSend('stop')" class="btn btn-outline-danger active">Stop</button>
        <br>
    </div>
</div>

<script>
    var joyparam = {
        "internalFillColor": "#FFFFFF",
        "internalStrokeColor": "#666666",
        "externalStrokeColor": "#000000"
    };

    var previous_x, previous_y

    var joy = new JoyStick('joyDiv', joyparam);
    //send_joystick_value
    setInterval(function () {
        if (joy.GetX() != previous_x || joy.GetY() != previous_y) {
            send_joystick_value(joy.GetX(), joy.GetY())
            previous_x = joy.GetX();
            previous_y = joy.GetY();
        }
    }, 50);

    var slider1 = document.getElementById("myRange1");
    var output1 = document.getElementById("demo1");
    output1.innerHTML = slider1.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider1.oninput = function () {
        output1.innerHTML = this.value;
        send_slider_value("gripper", this.value);
    }

    var slider2 = document.getElementById("myRange2");
    var output2 = document.getElementById("demo2");
    output2.innerHTML = slider2.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider2.oninput = function () {
        output2.innerHTML = this.value;
        send_slider_value("rotate gripper", this.value);
    }


    var slider3 = document.getElementById("myRange3");
    var output3 = document.getElementById("demo3");
    output3.innerHTML = slider3.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider3.oninput = function () {
        output3.innerHTML = this.value;
        send_slider_value("lift arm", this.value);
    }


    var slider4 = document.getElementById("myRange4");
    var output4 = document.getElementById("demo4");
    output4.innerHTML = slider4.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider4.oninput = function () {
        output4.innerHTML = this.value;
        send_slider_value("rotate arm", this.value);
    }


    var slider5 = document.getElementById("myRange5");
    var output5 = document.getElementById("demo5");
    output5.innerHTML = slider5.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider5.oninput = function () {
        output5.innerHTML = this.value;
        send_slider_value("snelheid", this.value);

    }
    $("#switchmodes >.btn").click(function () {
        $("#switchmodes >.btn").removeClass("active");
        $("#btnAutonoom").removeClass("active");
        $(this).addClass("active");
        if (this.classList.contains("autonoom")) {
            $("#btnAutonoom").addClass("active")
            doSend('autonoom')
        }
    })

    $("#startstop >.btn").click(function () {
        $("#startstop >.btn").removeClass("active");
        $(this).addClass("active");
    })

    function init() {
        output = document.getElementById("output");
        websocket = new WebSocket("ws://vps.anotherfoxguy.com:5000/ws/Controller");
        websocket.onopen = function (evt) {
            onOpen(evt)
        };
        websocket.onclose = function (evt) {
            onClose(evt)
        };
        websocket.onmessage = function (evt) {
            onMessage(evt)
        };
        websocket.onerror = function (evt) {
            onError(evt)
        };
    }

    init()

    function onOpen(evt) {
        console.log("CONNECTED");
    }

    function onClose(evt) {
        console.log("DISCONNECTED");
    }

    function onMessage(evt) {
        console.log('RESPONSE: ' + evt.data);
        if (evt.data.includes("ERROR")) {
        } else {
            var data = JSON.parse(evt.data)
            $("#select_robot").empty();
            for (let i = 0; i < data.length; i++) {
                const element = data [i];
                $("#select_robot").append("<a class=\"dropdown-item\" onclick=\"select_robot('" + element.Name + "')\">" + element.Name + "</a>");
            }
        }
    }

    function onError(evt) {
        console.log('ERROR:' + evt.data);
    }

    function doSend(message) {
        websocket.send("cmd|" + message);
    }

    function update_robot_list() {
        websocket.send("ls")
    }

    function select_robot(robot_name) {
        websocket.send("set|" + robot_name);
    }

    function send_slider_value(name, value) {
        doSend(name + "(" + value + ")")
    }

    function send_joystick_value(x, y) {
        doSend("joystick(" + x + " ," + y + ")")
    }


</script>

</body>
</html>