<!doctype html>
<html lang="en">
<head>
    <title>Controller GUI</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="joy.min.js"></script>
    <style>
        .slidecontainer {
            width: 100%;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            background: #4CAF50;
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

<body class="bg-light"></body>

<div class="container p-3 my-3 bg-dark text-white">
    <h1 class="text-center">Controller Robotica Groep 7</h1>
</div>

<div class="container p-3 my-3 border">
    <div id="joystickveld" style="height: 20px;"></div>
    <div id="joyDiv"
         style="width:300px;height:300px;margin-bottom:20px; border: 1px solid #9C9898; overflow: hidden; float: left;"></div>
    <div class="row">

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Gripper open/close</h6>
                <div class="slidecontainer">
                    <input type="range" min="-0.05" max="0.7" step="0.01" value="-0.05" class="slider" id="gripper_slider">
                    <p>Waarde: <span id="gripper_span"></span> radiaal</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Gripper pitch</h6>
                <div class="slidecontainer">
                    <input type="range" min="-1.57" max="1.57" step="0.01" value="0" class="slider" id="gripper_pitch_slider">
                    <p>Waarde: <span id="gripper_pitch_span"></span> radiaal</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Gripper roll</h6>
                <div class="slidecontainer">
                    <input type="range" min="-3.14" max="3.14" step="0.01" value="0" class="slider" id="gripper_roll_slider">
                    <p>Waarde: <span id="gripper_roll_span"></span> radiaal</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Arm long</h6>
                <div class="slidecontainer">
                    <input type="range" min="0" max="6" step="0.01" value="0" class="slider" id="arm_long_slider">
                    <p>Waarde: <span id="arm_long_span"></span> radiaal</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Arm short</h6>
                <div class="slidecontainer">
                    <input type="range" min="-3.00" max="0" step="0.01" value="0" class="slider" id="arm_short_slider">
                    <p>Waarde: <span id="arm_short_span"></span> radiaal</p>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="container p-3 my-3 border">
                <h6 class="text-center">Rotate arm base</h6>
                <div class="slidecontainer">
                    <input type="range" min="0" max="6.28" step="0.01" value="0" class="slider" id="rotate_arm_slider">
                    <p>Waarde: <span id="rotate_arm_span"></span> radiaal</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container p-3 my-3 border">
    <h6 class="text-center">Snelheid instellen robot voortbeweging</h6>
    <div class="slidecontainer">
        <input type="range" min="1" max="100" value="50" class="slider" id="snelheid_slider">
        <p>Waarde: <span id="snelheid_span"></span>%</p>
    </div>
</div>

<div class="container p-3 my-3 border">
    <div class="btn-group btn-block" id="switchmodes">
        <button type="button" onclick="doSend('manual')" class="btn btn-outline-primary active">Manual</button>
        <button type="button" onclick="doSend('moonrace')" class="btn btn-outline-primary">Moonrace</button>
        <button type="button" onclick="doSend('moondance')" class="btn btn-outline-primary">Moondance</button>
        <button type="button" onclick="doSend('moonwalk')" class="btn btn-outline-primary autonoom">Moonwalk</button>
        <button type="button" onclick="doSend('moonsurvival')" class="btn btn-outline-primary autonoom">Moonsurvival
        </button>
        <button type="button" onclick="doSend('moonmaze')" class="btn btn-outline-primary autonoom">Moonmaze</button>
        <button type="button" onclick="doSend('plant_the_flag')" class="btn btn-outline-primary">Plant the Flag</button>
        <div class="dropup">
            <button type="button" class="btn btn-outline-primary dropdown-toggle autonoom" data-toggle="dropdown">Select card
            </button>
            <div class="dropdown-menu">
                <a onclick="doSend('harten')" class="dropdown-item" href="#">Harten</a>
                <a onclick="doSend('klaver')" class="dropdown-item" href="#">Klaver</a>
                <a onclick="doSend('ruiten')" class="dropdown-item" href="#">Ruiten</a>
                <a onclick="doSend('schopen')" class="dropdown-item" href="#">Schopen</a>
            </div>
        </div>
    </div>

    <div class="btn-group btn-block" data-toggle="button" aria-label="Basic example">
        <button type="button" onclick="doSend('autonoom')" class="btn btn-outline-warning" id="btnAutonoom">Autonoom
        </button>
    </div>
</div>

<div class="container p-3 my-3 border">
    <button type="button" class="btn btn-outline-primary dropdown-toggle" data-toggle="dropdown" onclick="update_robot_list()">Robot keuze</button>
    <div class="dropdown-menu" id="select_robot">
    </div>
</div>

<div class="container p-3 my-3 border">
    <div class="btn-group btn-block" id="startstop">
        <button type="button" onclick="doSend('start')" class="btn btn-outline-success">Start</button>
        <button type="button" onclick="doSend('stop')" class="btn btn-outline-danger active">Stop</button>
        <br>
    </div>
</div>

<script>
    var joyparam = {
        "internalFillColor": "#FFFFFF",
        "internalStrokeColor": "#666666",
        "externalStrokeColor": "#000000"
    };

    var websocket

    var previous_x, previous_y

    var joy = new JoyStick('joyDiv', joyparam);
    //send_joystick_value
    setInterval(function () {
        if (joy.GetX() != previous_x || joy.GetY() != previous_y) {
            send_joystick_value(joy.GetX(), joy.GetY())
            previous_x = joy.GetX();
            previous_y = joy.GetY();
        }
    }, 50);

    var gripper_slider = document.getElementById("gripper_slider");
    var gripper_span = document.getElementById("gripper_span");
    gripper_span.innerHTML = gripper_slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    gripper_slider.oninput = function () {
        gripper_span.innerHTML = this.value;
        send_slider_value("gripper", this.value);
    }

    var gripper_pitch_slider = document.getElementById("gripper_pitch_slider");
    var gripper_pitch_span = document.getElementById("gripper_pitch_span");
    gripper_pitch_span.innerHTML = gripper_pitch_slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    gripper_pitch_slider.oninput = function () {
        gripper_pitch_span.innerHTML = this.value;
        send_slider_value("gripper_pitch", this.value);
    }

    var gripper_roll_slider = document.getElementById("gripper_roll_slider");
    var gripper_roll_span = document.getElementById("gripper_roll_span");
    gripper_roll_span.innerHTML = gripper_roll_slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    gripper_roll_slider.oninput = function () {
        gripper_roll_span.innerHTML = this.value;
        send_slider_value("gripper_roll", this.value);
    }

    var arm_long_slider = document.getElementById("arm_long_slider");
    var arm_long_span = document.getElementById("arm_long_span");
    arm_long_span.innerHTML = arm_long_slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    arm_long_slider.oninput = function () {
        arm_long_span.innerHTML = this.value;
        send_slider_value("arm_long", this.value);
    }

    var rotate_arm_slider = document.getElementById("rotate_arm_slider");
    var rotate_arm_span = document.getElementById("rotate_arm_span");
    rotate_arm_span.innerHTML = rotate_arm_slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    rotate_arm_slider.oninput = function () {
        rotate_arm_span.innerHTML = this.value;
        send_slider_value("rotate_arm_base", this.value);
    }

    var snelheid_slider = document.getElementById("snelheid_slider");
    var snelheid_span = document.getElementById("snelheid_span");
    snelheid_span.innerHTML = snelheid_slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    snelheid_slider.oninput = function () {
        snelheid_span.innerHTML = this.value;
        send_slider_value("speed", this.value);

    }

    var arm_short_slider = document.getElementById("arm_short_slider");
    var arm_short_span = document.getElementById("arm_short_span");
    arm_short_span.innerHTML = arm_short_slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    arm_short_slider.oninput = function () {
        arm_short_span.innerHTML = this.value;
        send_slider_value("arm_short", this.value);
    }

    $("#switchmodes >.btn").click(function () {
        $("#switchmodes >.btn").removeClass("active");
        $("#btnAutonoom").removeClass("active");
        $(this).addClass("active");
        if (this.classList.contains("autonoom")) {
            $("#btnAutonoom").addClass("active")
            doSend('autonoom')
        }
    })

    $("#startstop >.btn").click(function () {
        $("#startstop >.btn").removeClass("active");
        $(this).addClass("active");
    })

    function init() {
        output = document.getElementById("output");
        websocket = new WebSocket("ws://vps.anotherfoxguy.com:5000/ws/Controller");
        websocket.onopen = function (evt) {
            onOpen(evt)
        };
        websocket.onclose = function (evt) {
            onClose(evt)
        };
        websocket.onmessage = function (evt) {
            onMessage(evt)
        };
        websocket.onerror = function (evt) {
            onError(evt)
        };
    }

    init()

    function onOpen(evt) {
        console.log("CONNECTED");
    }

    function onClose(evt) {
        console.log("DISCONNECTED");
    }

    function onMessage(evt) {
        console.log('RESPONSE: ' + evt.data);
        if (evt.data.includes("ERROR")) {
        } else {
            var data = JSON.parse(evt.data)
            $("#select_robot").empty();
            for (let i = 0; i < data.length; i++) {
                const element = data [i];
                $("#select_robot").append("<a class=\"dropdown-item\" onclick=\"select_robot('" + element.Name + "')\">" + element.Name + "</a>");
            }
        }
    }

    function onError(evt) {
        console.log('ERROR:' + evt.data);
    }

    function doSend(message) {
        if(websocket.readyState != WebSocket.OPEN)
            return
        websocket.send("cmd|" + message);
    }

    function update_robot_list() {
        if(websocket.readyState != WebSocket.OPEN)
            return
        websocket.send("ls")
    }

    function select_robot(robot_name) {
        websocket.send("set|" + robot_name);
    }

    function send_slider_value(name, value) {
        doSend(name + "(" + value + ")")
    }

    function send_joystick_value(x, y) {
        doSend("joystick(" + x + " ," + y + ")")
    }


</script>

</body>
</html>
